<!--@layout(/layout/basic/layout.html)-->
<div class="section" module="board_writePackage_1002">
    <!--@css(/css/module/board/writePackage.css)-->
    <div module="board_write_1002">
        <!--
            $login_page_url = /member/login.html
            $deny_access_url = /index.html
        -->
        <div class="ec-base-table typeWrite">
            <table border="0">
            <caption>글쓰기 폼</caption>
            <colgroup>
                <col style="width:100%;" />
                <col style="width:100%;" />
            </colgroup>
            <tbody>
                <tr>
                    <th scope="row" class="RW">카테고리<span class="required">*</span></th>
                    <td>{$form.board_category}</td>
                </tr>
                <tr>
                    <th scope="row" class="RW">제목<span class="required">*</span></th>
                    <td>{$form.subject}</td>
                </tr>
                <tr>
                    <th scope="row" class="RW top">내용<span class="required">*</span></th>
                    <td>
                        {$form.content}
                    </td>
                </tr>
            </tbody>
            </table>
        </div>

        <div class="ec-base-button gBottom">
            <span class="gRight">
                <a href="#none" class="btnSubmitFix sizeM" onclick="{$action_write}">등록하기</a>
            </span>
        </div>
    </div>
</div>

<script>
(function () {
  function enhanceSelect(select, { placeholder = '카테고리를 선택해 주세요' } = {}) {
    if (!select || select.__enhanced) return;
    select.__enhanced = true;

    select.classList.add('select-visually-hidden');

    const wrap = document.createElement('div');
    wrap.className = 'cs-wrap';
    wrap.setAttribute('data-target', select.id || '');
    wrap.style.position = 'relative';

    const trigger = document.createElement('button');
    trigger.type = 'button';
    trigger.className = 'cs-trigger';
    trigger.setAttribute('aria-haspopup', 'listbox');
    trigger.setAttribute('aria-expanded', 'false');

    const label = document.createElement('span');
    label.className = 'cs-label';

    const icon = document.createElement('div');
    icon.classList.add('cs-icon');
    icon.innerHTML = `
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
    <mask id="mask0_3128_44853" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
        <rect x="24" y="24" width="24" height="24" transform="rotate(-180 24 24)" fill="#D9D9D9"/>
    </mask>
    <g mask="url(#mask0_3128_44853)">
        <path d="M17.0061 9.70006L11.6984 15.0078L6.39062 9.70006L7.09838 8.99231L11.6984 13.5923L16.2984 8.99231L17.0061 9.70006Z" fill="#393939"/>
    </g>
    </svg>`;

    trigger.appendChild(label);
    trigger.appendChild(icon);

    const list = document.createElement('div');
    list.className = 'cs-list';
    list.setAttribute('role', 'listbox');
    list.setAttribute('tabindex', '-1');

    const group = document.createElement('div');
    group.className = 'cs-group';
    list.appendChild(group);

    const options = Array.from(select.options);
    const buttons = options.map((opt, idx) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'cs-opt';
      btn.setAttribute('role', 'option');
      btn.setAttribute('data-value', opt.value);
      btn.setAttribute('aria-selected', opt.selected ? 'true' : 'false');
      btn.innerHTML = `<span>${opt.textContent}</span>` + (opt.dataset.price ? `<span class="cs-price">${opt.dataset.price}</span>` : '');

      btn.addEventListener('click', () => {
        setValue(opt.value, true);
        close();
        trigger.focus();
      });

      return btn;
    });

    buttons.forEach(b => group.appendChild(b));
    wrap.appendChild(trigger);
    wrap.appendChild(list);

    select.parentNode.insertBefore(wrap, select.nextSibling);

    function refreshLabel() {
      const selectedOpt = select.selectedOptions[0];
      label.textContent = selectedOpt ? selectedOpt.textContent : placeholder;
      if (selectedOpt && selectedOpt.value !== '') {
        label.style.color = '#3D3D3D';
      } else {
        label.style.color = '#ABABAB';
      }
      buttons.forEach(b => {
        b.setAttribute('aria-selected', b.getAttribute('data-value') === select.value ? 'true' : 'false');
      });
    }

    function open() {
      wrap.classList.add('open');
      trigger.setAttribute('aria-expanded', 'true');
      group.style.display = 'block';
      const cur = buttons.find(b => b.getAttribute('data-value') === select.value) || buttons[0];
      setTimeout(() => {
        list.focus();
        if (cur) {
          cur.scrollIntoView({ block: 'nearest' });
        }
      }, 0);
      bindOutside();
    }

    function close() {
      wrap.classList.remove('open');
      trigger.setAttribute('aria-expanded', 'false');
      group.style.display = 'none';
      unbindOutside();
    }

    function toggle() {
      wrap.classList.contains('open') ? close() : open();
    }

    function setValue(value, emit) {
      if (select.value !== value) {
        select.value = value;
        if (emit) {
          select.dispatchEvent(new Event('change', { bubbles: true }));
        }
      }
      refreshLabel();
    }

    trigger.addEventListener('click', toggle);
    trigger.addEventListener('keydown', (e) => {
      if (e.key === ' ' || e.key === 'Enter' || e.key === 'ArrowDown') {
        e.preventDefault();
        open();
      }
    });

    list.addEventListener('keydown', (e) => {
      const idx = buttons.findIndex(b => b.getAttribute('data-value') === select.value);
      const last = buttons.length - 1;
      let nextIdx = idx < 0 ? 0 : idx;

      if (e.key === 'Escape') { e.preventDefault(); close(); trigger.focus(); return; }
      if (e.key === 'Tab') { close(); return; }

      if (e.key === 'ArrowDown') { e.preventDefault(); nextIdx = Math.min(last, (idx < 0 ? 0 : idx + 1)); }
      else if (e.key === 'ArrowUp') { e.preventDefault(); nextIdx = Math.max(0, (idx < 0 ? 0 : idx - 1)); }
      else if (e.key === 'Home') { e.preventDefault(); nextIdx = 0; }
      else if (e.key === 'End') { e.preventDefault(); nextIdx = last; }
      else if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); close(); trigger.focus(); return; }
      else { return; }

      const targetBtn = buttons[nextIdx];
      if (targetBtn) {
        setValue(targetBtn.getAttribute('data-value'), true);
        targetBtn.scrollIntoView({ block: 'nearest' });
      }
    });

    let outsideBound = false;
    function onDocClick(e) {
      if (!wrap.contains(e.target)) close();
    }

    function bindOutside() {
      if (!outsideBound) {
        document.addEventListener('mousedown', onDocClick);
        document.addEventListener('touchstart', onDocClick, { passive: true });
        outsideBound = true;
      }
    }

    function unbindOutside() {
      if (outsideBound) {
        document.removeEventListener('mousedown', onDocClick);
        document.removeEventListener('touchstart', onDocClick);
        outsideBound = false;
      }
    }

    select.addEventListener('change', refreshLabel);

    refreshLabel();
  }

  document.addEventListener('DOMContentLoaded', () => {
    const sel = document.getElementById('board_category');
    if (sel) enhanceSelect(sel, { placeholder: '카테고리를 선택해 주세요' });
  });
})();
</script>

<style>
#cs_header,
#notice_header {
    position: relative;
    justify-content: center;
    display: flex;
    width: 100%;
    padding: 16px;
    align-items: center;
}

#cs_header .header_back,
#notice_header .header_back {
    position: absolute;
    left: 16px;
    top: 16px;
    width: 24px;
}

#cs_header .header_back img,
#notice_header .header_back img {
    width: 100%;
}

#cs_header p,
#notice_header p {
    color: var(--G-800, var(--Gray-800, #393939));
    text-align: center;
    font-size: 16px;
    font-style: normal;
    font-weight: 600;
    line-height: 22px; /* 137.5% */
    letter-spacing: -0.32px;
}

tbody {
    display: flex;
    flex-direction: column;
    gap: 32px;
}

tr {
    display: flex;
    flex-direction: column;
}

th {
    text-align: left;
    color: var(--G-800, var(--Gray-800, #393939));
    font-size: 16px;
    font-style: normal;
    font-weight: 600;
    line-height: 20px; /* 125% */
    letter-spacing: -0.32px;
}

.required {
    color: var(--Point, #F46200);
    font-size: 16px;
    font-style: normal;
    font-weight: 600;
    line-height: 20px;
    letter-spacing: -0.32px;
    margin-left: 2px;
}

td {
    display: flex;
    padding: 16px;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 12px;
    align-self: stretch;
    border-radius: 12px;
    background: var(--G-0, #FFF);
    margin-top: 12px;
}

#subject {
    width: calc(100% - 32px);
    margin-left: 16px;
}

.fr-box {
    width: calc(100% - 32px);;
}

.ec-froala-theme .fr-toolbar.fr-top {
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
    border: 1px solid #D9D9D9 !important;
}

.fr-wrapper {
    border-left: 1px solid #D9D9D9 !important;
    border-right: 1px solid #D9D9D9 !important;
}

.second-toolbar {
    border-bottom-left-radius: 8px !important;
    border-bottom-right-radius: 8px !important;
    border: 1px solid #D9D9D9 !important;
}

.select-visually-hidden {
    position: absolute !important;
    opacity: 0 !important;
    pointer-events: none !important;
    width: 0 !important;
    height: 0 !important;
    margin: 0 !important;
    padding: 0 !important;
    border: 0 !important;
}

.cs-wrap {
    width: calc(100% - 32px);
}

.cs-list {
    overflow-y: auto;
}

.ec-base-button {
    position: fixed;
    left: 0;
    bottom: 0;
    display: flex;
    width: 100%;
    padding: 16px 16px 32px 16px;
    justify-content: space-between;
    align-items: center;
    align-self: stretch;
    background: var(--G-0, #FFF);
    box-shadow: 0 0 12px 0 rgba(140, 140, 140, 0.20);
    z-index: 999;
}

.gRight {
    width: 100%;
}

.btnSubmitFix {
    display: flex;
    width: 100%;
    height: 48px;
    padding: 10px;
    justify-content: center;
    align-items: center;
    gap: 10px;
    flex: 1 0 0;
    border-radius: 8px;
    background: #1B8862;
    color: #FFF;
    font-size: 16px;
    font-style: normal;
    font-weight: 600;
    line-height: 24px; /* 150% */
    letter-spacing: -0.32px;
    border: none;
}
</style>